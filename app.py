import streamlit as st from telethon import TelegramClient from telethon.sessions import StringSession import asyncio import nest_asyncio nest_asyncio.apply() st.set_page_config(page_title="TeleBooks - ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨", page_icon="ğŸ“š") # ğŸ”‘ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø±Ø§Ø± (Ø¨Ø¯ÙˆÙ† phone!) api_id = int(st.secrets["api_id"]) api_hash = st.secrets["api_hash"] session_string = st.secrets["session_string"] channel_id = int(st.secrets["channel_id"]) # ğŸ“¦ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« def search_books(query): results = [] try: loop = asyncio.new_event_loop() asyncio.set_event_loop(loop) # âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… session_string Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† phone client = TelegramClient(StringSession(session_string), api_id, api_hash) async def do_search(): nonlocal results try: # âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø£Ùˆ Ø±Ù…Ø² await client.start() st.info("ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©...") entity = await client.get_entity(channel_id) st.info(f"âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€: {entity.title}") st.info("ğŸ“ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©...") async for message in client.iter_messages( entity, search=query, limit=None ): if message.file: file_name = message.file.name or message.text or 'Ù…Ù„Ù' results.append({ 'channel': entity.title, 'message_id': message.id, 'text': message.text or 'Ø¨Ø¯ÙˆÙ† ÙˆØµÙ', 'file_name': file_name, 'size': message.file.size or 0, 'date': message.date, 'channel_id': entity.id, 'username': entity.username or 'no-username' }) if results: st.success(f"âœ… ÙˆØ¬Ø¯Øª {len(results)} Ù†ØªÙŠØ¬Ø©!") else: st.warning("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«") except Exception as e: st.error(f"âŒ Ø®Ø·Ø£: {str(e)}") st.info("ğŸ’¡ ØªØ£ÙƒØ¯ Ù…Ù†: 1) session_string ØµØ­ÙŠØ­ 2) channel_id ØµØ­ÙŠØ­ 3) Ù„Ø¯ÙŠÙƒ ÙˆØµÙˆÙ„ Ù„Ù„Ù‚Ù†Ø§Ø©") await client.disconnect() loop.run_until_complete(asyncio.wait_for(do_search(), timeout=60)) loop.close() except asyncio.TimeoutError: st.error("Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø¨Ø­Ø«. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.") except Exception as e: st.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)}") return results # ğŸ’¡ Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ (Ù…ÙØ¹Ø¯Ù‘Ù„) if st.button("ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©"): with st.spinner("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±..."): try: loop = asyncio.new_event_loop() asyncio.set_event_loop(loop) client = TelegramClient(StringSession(session_string), api_id, api_hash) async def test_connection(): await client.start() try: entity = await client.get_entity(channel_id) st.success(f"âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©: **{entity.title}**") messages = await client.get_messages(entity, limit=1) if messages: st.info(f"âœ… ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ - Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©: {messages[0].date}") st.success("ğŸ‰ Ø§Ù„Ø¬Ù„Ø³Ø© ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„!") except Exception as e: st.error(f"âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: {str(e)}") await client.disconnect() loop.run_until_complete(test_connection()) loop.close() except Exception as e: st.error(f"âŒ Ø®Ø·Ø£: {str(e)}") st.title("ğŸ“š TeleBooks - Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒØªØ¨") st.markdown("Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒØªØ¨ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ù‚Ù†Ø§Ø© ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…") # ğŸ” Ø§Ù„Ø¨Ø­Ø« query = st.text_input("ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨:", placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ø¤Ù„Ù") if 'results' not in st.session_state: st.session_state.results = [] if 'current_index' not in st.session_state: st.session_state.current_index = 0 if st.button("Ø¨Ø­Ø«"): if query.strip(): with st.spinner("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©..."): results = search_books(query.strip()) if results: st.session_state.results = results st.session_state.current_index = 0 else: st.warning("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø«") # ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚) if st.session_state.results: result = st.session_state.results[st.session_state.current_index] st.markdown("---") st.subheader(f"ğŸ“– {result['file_name']}") st.write(f"**Ø§Ù„Ù‚Ù†Ø§Ø©:** {result['channel']}") st.write(f"**Ø§Ù„ÙˆØµÙ:** {result['text'][:300]}...") st.write(f"**Ø§Ù„Ø­Ø¬Ù…:** {result['size'] / (1024*1024):.2f} MB") st.write(f"**Ø§Ù„ØªØ§Ø±ÙŠØ®:** {result['date'].strftime('%Y-%m-%d %H:%M')}") if result['username']: link = f"https://t.me/{result['username']}/{result['message_id']}" else: channel_num = str(result['channel_id']).replace('-100', '') link = f"https://t.me/c/{channel_num}/{result['message_id']}" st.markdown(f"### [ğŸ“¥ ÙØªØ­ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…]({link})") st.info(f"Ø§Ù„Ù†ØªÙŠØ¬Ø© {st.session_state.current_index + 1} Ù…Ù† {len(st.session_state.results)}") col1, col2 = st.columns(2) with col1: if st.session_state.current_index > 0: if st.button("â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚"): st.session_state.current_index -= 1 st.rerun() with col2: if st.session_state.current_index < len(st.session_state.results) - 1: if st.button("â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ"): st.session_state.current_index += 1 st.rerun() # ğŸ“ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ st.sidebar.title("âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª") st.sidebar.info(""" **ğŸ“š Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:** Ø¨Ø­Ø« ÙØ¹Ù„ÙŠ ÙÙŠ Ù‚Ù†ÙˆØ§Øª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù„Ø³Ø© Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©. **âœ… Ø§Ù„Ù…Ø²Ø§ÙŠØ§:** - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ - ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Streamlit Cloud Ø¨Ø¯ÙˆÙ† ØªÙØ§Ø¹Ù„ Ù…Ø¨Ø§Ø´Ø± **ğŸ”‘ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:** - `api_id`, `api_hash` Ù…Ù† my.telegram.org - `session_string` ØµØ§Ù„Ø­ - `channel_id` ØµØ­ÙŠØ­ (Ù…Ø¹ `-100`) """)